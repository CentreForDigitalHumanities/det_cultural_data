{
  "hash": "714b7a70e50256df40f22da572366cba",
  "result": {
    "markdown": "---\ntitle: \"Cleaning data\"\nexecute:   \n  enabled: true\n  error: true\n  freeze: auto\n---\n\n\n\n## Previous steps {.unnumbered}\n\n::: {.cell execution_count=2}\n``` {.python .cell-code}\nimport pandas as pd\ndata_file = 'data/data.csv'\ndf = pd.read_csv(data_file)\nprint(df.shape)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n(36151, 9)\n```\n:::\n:::\n\n\n::: {.cell execution_count=3}\n``` {.python .cell-code}\ncolumn_names = df.columns\ndf.head(5)\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Year of arrival at port of disembarkation</th>\n      <th>Voyage ID</th>\n      <th>Vessel name</th>\n      <th>Voyage itinerary imputed port where began (ptdepimp) place</th>\n      <th>Voyage itinerary imputed principal place of slave purchase (mjbyptimp)</th>\n      <th>Voyage itinerary imputed principal port of slave disembarkation (mjslptimp) place</th>\n      <th>VOYAGEID2</th>\n      <th>Captives arrived at 1st port</th>\n      <th>Captain's name</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1714.0</td>\n      <td>16109</td>\n      <td>Freeke Gally</td>\n      <td>Bristol</td>\n      <td>NaN</td>\n      <td>Kingston</td>\n      <td>NaN</td>\n      <td>283.0</td>\n      <td>Neale, Alexander</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>1713.0</td>\n      <td>16110</td>\n      <td>Greyhound Gally</td>\n      <td>Bristol</td>\n      <td>NaN</td>\n      <td>Jamaica, place unspecified</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>Selkirk, Alexander&lt;br/&gt; Forrest, Henry</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>1714.0</td>\n      <td>16111</td>\n      <td>Jacob</td>\n      <td>Bristol</td>\n      <td>NaN</td>\n      <td>Kingston</td>\n      <td>NaN</td>\n      <td>130.0</td>\n      <td>Nicholls, Philip</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>1714.0</td>\n      <td>16112</td>\n      <td>Jason Gally</td>\n      <td>Bristol</td>\n      <td>NaN</td>\n      <td>Port Royal</td>\n      <td>NaN</td>\n      <td>278.0</td>\n      <td>Plummer, John</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>1713.0</td>\n      <td>16113</td>\n      <td>Lawford Gally</td>\n      <td>Bristol</td>\n      <td>Africa, port unspecified</td>\n      <td>Newcastle (Nevis)</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>Stretton, Joseph</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nNow that we got some familiarity with our dataset, it is time to clean our data, i.e. to get rid of all those NaN values and anything else that might effect our data analysis. Where to start? Well, inspecting the DataFrame by eye, we see several NaNs in the first 5 rows of our DataFrame. The first column we see NaNs is \"Voyage itinerary imputed principal place of slave purchase\", the fourth column (index 5). It would be nice to check if also other column have NaNs.<br>\nLet's start with the first column, \"Year of arrival at port of disembarkation\" (index 0), let's check if this column contains any NaN and then we will repeat the same process for all the other columns.\n\n::: {.cell execution_count=4}\n\n::: {.cell-output .cell-output-display execution_count=4}\n```{=html}\n<style>.box {\n\tborder: 1px solid !important;\n    border-radius: 5px !important;\n\tpadding: 10px !important;\n\tmargin: 0px 10px 0px 10px !important;\n}\n\n.sub-box {\n  display: flex !important; \n  flex-direction: row !important; \n  align-items: center !important;\n}\n\n.type1 {\n\tborder-color: black;\n\tbackground-color: rgb(246, 255, 222); \n}\n\n.type2 {\n\tborder-color: black;\n\tbackground-color: rgb(227, 242, 193); \n}\n\n.type3 {\n\tborder-color: black;\n\tbackground-color: rgb(201, 219, 178); \n}\n\n.type4 {\n\tborder-color: black;\n\tbackground-color: rgb(170, 200, 167); \n}\n\n.type5 {\n    border-color: black;\n\tbackground-color: rgb(181, 192, 208);\n}\n\n.type6 {\n    border-color: black;\n\tbackground-color: rgb(255, 195, 116);\n}\n\n.picture {\n\twidth: 30px; \n\theight: 30px;\n\tmargin: 0 0 0px 0;\n}\n\n.ctitle {\n    margin: 0px 0px 0px 20px;\n}</style> \n            <div class=\"box type1\">\n                    <div class=\"sub-box\">\n                        <img src=\"myutils/icons/question.png\" alt=\"Icon\" class=\"picture\"/>\n                        <div class=\"ctitle\">\n                            <u><h4><strong>Question(s)</strong></h4></u>\n                        </div>\n                    </div>\n                    <div class=\"sub-box\">\n                        Is there any NaN in the first column? How many are they?\n                    </div>\n            </div>\n        \n            <div class=\"box type2\">\n                <div class=\"sub-box\">\n                    <img src=\"myutils/icons/thinking.png\" alt=\"Icon\" class=\"picture\"/>\n                    <div class=\"ctitle\">\n                        <u><h4><strong>What to do?</strong></h4></u>\n                    </div>\n                </div>\n                <div class=\"sub-box\">\n                    Go through all the 36151 entries of the first column and look for NaN values.\n                </div>\n            </div>    \n        \n            <div class=\"box type3\">\n                <div class=\"sub-box\">\n                    <img src=\"myutils/icons/tools.png\" alt=\"Icon\" class=\"picture\"/>\n                    <div class=\"ctitle\">\n                        <u><h4><strong>(Python) Tools</strong></h4></u>\n                    </div>\n                </div>\n                <div class=\"sub-box\">\n                    <ul><li><code>pandas</code> column selector method <code>.iloc</code>;</li><li><code>pandas</code> method <code>.is_na</code>;</li><li>Python function <code>.sum()</code>;</li><li>Python function <code>print()</code>.</li></ul>\n                </div>            \n            </div>    \n        \n            <div class=\"box type4\">\n                <div class=\"sub-box\">\n                    <img src=\"myutils/icons/code_expl.png\" alt=\"Icon\" class=\"picture\"/>\n                    <div class=\"ctitle\">\n                        <u><h4><strong>Coding</strong></h4></u>\n                    </div>\n                </div>\n                <div class=\"sub-box\">\n                    <div>\n                        <ul><li><code>arr_year = df.iloc[:,0]</code>, we first select the first column of the DataFrame using the     <code>pandas</code> method <code>.iloc[]</code> and we store the selected column in the new     variable <code>arr_year</code> (we already used this method in the previous chapter);</li><li><code>arr_year_na = arr_year.isna()</code>, we apply the <code>pandas</code> method <code>.isna()</code>.     When we apply the <code>.isna()</code> method, we obtain a result with the same dimensions of the     object we applied it to, containing either True or False depending on if the corresponding value is     a NaN (or na, non arithmetic) value or not. Indeed the result of this method just answers the question:     is this value na?     We store the result in the variable <code>arr_year_na</code> (you are free to use a more descriptive name);</li><li><code>print(arr_year_na.sum())</code>, in Python the boolean values True and False are equivalent to 1 and 0,     respectively. This means that     if we have an array (a list or sequence of values) containing True and False, if we sum all the values,     we would obtain the number of True values (as they count as 1 and everything else counts as 0). These     True values correspond to the cases when  the method <code>.isna()</code> found a NaN, so that summing     all these values means, as a matter of fact, counting how many NaNs have been found.</li></ul>\n                    </div>       \n                </div>\n            </div>    \n        \n            <div class=\"box type5\">\n                <div class=\"sub-box\">\n                    <img src=\"myutils/icons/wiz.png\" alt=\"Icon\" class=\"picture\"/>\n                    <div class=\"ctitle\">\n                        <u><h4><strong>Expert Coding</strong></h4></u>\n                    </div>\n                </div>\n                <div class=\"sub-box\">\n                    <div>\n                        <code>print(df.iloc[:,0].isna())</code>, we can apply methods and function one after another, using less coding lines and saving space in our computer memory\n                    </div>  \n                </div>\n            </div>    \n        \n```\n:::\n:::\n\n\n::: {.cell execution_count=5}\n``` {.python .cell-code}\narr_year = df.iloc[:,0]\narr_year_na = arr_year.isna()\nprint(arr_year_na)\nprint('Total number of NaNs in the first column:',arr_year_na.sum())\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n0        False\n1        False\n2        False\n3        False\n4        False\n         ...  \n36146    False\n36147    False\n36148    False\n36149    False\n36150    False\nName: Year of arrival at port of disembarkation, Length: 36151, dtype: bool\nTotal number of NaNs in the first column: 1\n```\n:::\n:::\n\n\n::: {.cell execution_count=6}\n``` {.python .cell-code}\nsolution = 'The first column contains 1 NaN value'\nquestion_box(solution=solution)\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```{=html}\n<style>.box {\n\tborder: 1px solid !important;\n    border-radius: 5px !important;\n\tpadding: 10px !important;\n\tmargin: 0px 10px 0px 10px !important;\n}\n\n.sub-box {\n  display: flex !important; \n  flex-direction: row !important; \n  align-items: center !important;\n}\n\n.type1 {\n\tborder-color: black;\n\tbackground-color: rgb(246, 255, 222); \n}\n\n.type2 {\n\tborder-color: black;\n\tbackground-color: rgb(227, 242, 193); \n}\n\n.type3 {\n\tborder-color: black;\n\tbackground-color: rgb(201, 219, 178); \n}\n\n.type4 {\n\tborder-color: black;\n\tbackground-color: rgb(170, 200, 167); \n}\n\n.type5 {\n    border-color: black;\n\tbackground-color: rgb(181, 192, 208);\n}\n\n.type6 {\n    border-color: black;\n\tbackground-color: rgb(255, 195, 116);\n}\n\n.picture {\n\twidth: 30px; \n\theight: 30px;\n\tmargin: 0 0 0px 0;\n}\n\n.ctitle {\n    margin: 0px 0px 0px 20px;\n}</style>\n            <div class=\"box type6\">\n                <div class=\"sub-box\">\n                    <img src=\"myutils/icons/solution.png\" alt=\"Icon\" class=\"picture\"/>\n                    <div class=\"ctitle\">\n                        <u><h4><strong>Answer</strong></h4></u>\n                    </div>\n                </div>\n                <div class=\"sub-box\">\n                    The first column contains 1 NaN value\n                </div>\n            </div>    \n        \n```\n:::\n:::\n\n\nIn this way we found our that the first column has 1 NaN (or na) value, that would have been quite hard to spot by eye scrolling 36151 lines! <br>\nIt is great that we found 1 NaN in the first column, but where exactly it is located? What's the corresponding Voyage ID of that value?\n\n::: {.cell execution_count=7}\n\n::: {.cell-output .cell-output-display execution_count=7}\n```{=html}\n<style>.box {\n\tborder: 1px solid !important;\n    border-radius: 5px !important;\n\tpadding: 10px !important;\n\tmargin: 0px 10px 0px 10px !important;\n}\n\n.sub-box {\n  display: flex !important; \n  flex-direction: row !important; \n  align-items: center !important;\n}\n\n.type1 {\n\tborder-color: black;\n\tbackground-color: rgb(246, 255, 222); \n}\n\n.type2 {\n\tborder-color: black;\n\tbackground-color: rgb(227, 242, 193); \n}\n\n.type3 {\n\tborder-color: black;\n\tbackground-color: rgb(201, 219, 178); \n}\n\n.type4 {\n\tborder-color: black;\n\tbackground-color: rgb(170, 200, 167); \n}\n\n.type5 {\n    border-color: black;\n\tbackground-color: rgb(181, 192, 208);\n}\n\n.type6 {\n    border-color: black;\n\tbackground-color: rgb(255, 195, 116);\n}\n\n.picture {\n\twidth: 30px; \n\theight: 30px;\n\tmargin: 0 0 0px 0;\n}\n\n.ctitle {\n    margin: 0px 0px 0px 20px;\n}</style> \n            <div class=\"box type1\">\n                    <div class=\"sub-box\">\n                        <img src=\"myutils/icons/question.png\" alt=\"Icon\" class=\"picture\"/>\n                        <div class=\"ctitle\">\n                            <u><h4><strong>Question(s)</strong></h4></u>\n                        </div>\n                    </div>\n                    <div class=\"sub-box\">\n                        Where is the NaN value located in the first column?\n                    </div>\n            </div>\n        \n            <div class=\"box type2\">\n                <div class=\"sub-box\">\n                    <img src=\"myutils/icons/thinking.png\" alt=\"Icon\" class=\"picture\"/>\n                    <div class=\"ctitle\">\n                        <u><h4><strong>What to do?</strong></h4></u>\n                    </div>\n                </div>\n                <div class=\"sub-box\">\n                    Go through all the 36151 entries of the first column and look for the NaN value.\n                </div>\n            </div>    \n        \n            <div class=\"box type3\">\n                <div class=\"sub-box\">\n                    <img src=\"myutils/icons/tools.png\" alt=\"Icon\" class=\"picture\"/>\n                    <div class=\"ctitle\">\n                        <u><h4><strong>(Python) Tools</strong></h4></u>\n                    </div>\n                </div>\n                <div class=\"sub-box\">\n                    <ul><li>Python masking.</li></ul>\n                </div>            \n            </div>    \n        \n            <div class=\"box type4\">\n                <div class=\"sub-box\">\n                    <img src=\"myutils/icons/code_expl.png\" alt=\"Icon\" class=\"picture\"/>\n                    <div class=\"ctitle\">\n                        <u><h4><strong>Coding</strong></h4></u>\n                    </div>\n                </div>\n                <div class=\"sub-box\">\n                    <div>\n                        <ul><li><code>df[arr_year_na]</code>, here we will use one of the most useful features when working with     DataFrames: masking. From our previous coding, arr_year_na is an object with the same shape and     features of the first column, but instead of containing years, it contains True and False values,     where True corresponds to NaNs found applying the method <code>.isna()</code>. If we consider     our DataFrame <code>df</code>, we can use this object to select data from it. What are we going to     select? Well, <code>arr_year_na</code> has a name, and that is the name of the first column, so we     will select that. We will also select only the rows where <code>arr_year_na</code> is True.</li></ul>\n                    </div>       \n                </div>\n            </div>    \n        \n```\n:::\n:::\n\n\n::: {.cell execution_count=8}\n``` {.python .cell-code}\ndf[arr_year_na]\n```\n\n::: {.cell-output .cell-output-display execution_count=8}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Year of arrival at port of disembarkation</th>\n      <th>Voyage ID</th>\n      <th>Vessel name</th>\n      <th>Voyage itinerary imputed port where began (ptdepimp) place</th>\n      <th>Voyage itinerary imputed principal place of slave purchase (mjbyptimp)</th>\n      <th>Voyage itinerary imputed principal port of slave disembarkation (mjslptimp) place</th>\n      <th>VOYAGEID2</th>\n      <th>Captives arrived at 1st port</th>\n      <th>Captain's name</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>32248</th>\n      <td>NaN</td>\n      <td>91909</td>\n      <td>Kitty</td>\n      <td>Liverpool</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>Fisher, Joseph</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {.cell execution_count=9}\n\n::: {.cell-output .cell-output-display execution_count=9}\n```{=html}\n<style>.box {\n\tborder: 1px solid !important;\n    border-radius: 5px !important;\n\tpadding: 10px !important;\n\tmargin: 0px 10px 0px 10px !important;\n}\n\n.sub-box {\n  display: flex !important; \n  flex-direction: row !important; \n  align-items: center !important;\n}\n\n.type1 {\n\tborder-color: black;\n\tbackground-color: rgb(246, 255, 222); \n}\n\n.type2 {\n\tborder-color: black;\n\tbackground-color: rgb(227, 242, 193); \n}\n\n.type3 {\n\tborder-color: black;\n\tbackground-color: rgb(201, 219, 178); \n}\n\n.type4 {\n\tborder-color: black;\n\tbackground-color: rgb(170, 200, 167); \n}\n\n.type5 {\n    border-color: black;\n\tbackground-color: rgb(181, 192, 208);\n}\n\n.type6 {\n    border-color: black;\n\tbackground-color: rgb(255, 195, 116);\n}\n\n.picture {\n\twidth: 30px; \n\theight: 30px;\n\tmargin: 0 0 0px 0;\n}\n\n.ctitle {\n    margin: 0px 0px 0px 20px;\n}</style>\n            <div class=\"box type6\">\n                <div class=\"sub-box\">\n                    <img src=\"myutils/icons/solution.png\" alt=\"Icon\" class=\"picture\"/>\n                    <div class=\"ctitle\">\n                        <u><h4><strong>Answer</strong></h4></u>\n                    </div>\n                </div>\n                <div class=\"sub-box\">\n                    The row containing a NaN in the first column (\"Year of arrival at port of disembarkation\") has index 32248, it misses information about its itinerary (only the starting port is present) and number of captives, and its ID is 91909\n                </div>\n            </div>    \n        \n```\n:::\n:::\n\n\nIn this way we can inspect NaNs one by one and we can make a decision about how to handle them. In our DataFrame there are thousands of NaNs (as you will see in a minute) and going through ALL of them one by one is not a good idea. Let's first try to figure out if the other columns have also NaNs and how many are they. The process will be quite straightforward as we already did it for one of the columns, so what we need to do now is to repeat the same procedure for all the other columns.\n\n::: {.cell execution_count=10}\n\n::: {.cell-output .cell-output-display execution_count=10}\n```{=html}\n<style>.box {\n\tborder: 1px solid !important;\n    border-radius: 5px !important;\n\tpadding: 10px !important;\n\tmargin: 0px 10px 0px 10px !important;\n}\n\n.sub-box {\n  display: flex !important; \n  flex-direction: row !important; \n  align-items: center !important;\n}\n\n.type1 {\n\tborder-color: black;\n\tbackground-color: rgb(246, 255, 222); \n}\n\n.type2 {\n\tborder-color: black;\n\tbackground-color: rgb(227, 242, 193); \n}\n\n.type3 {\n\tborder-color: black;\n\tbackground-color: rgb(201, 219, 178); \n}\n\n.type4 {\n\tborder-color: black;\n\tbackground-color: rgb(170, 200, 167); \n}\n\n.type5 {\n    border-color: black;\n\tbackground-color: rgb(181, 192, 208);\n}\n\n.type6 {\n    border-color: black;\n\tbackground-color: rgb(255, 195, 116);\n}\n\n.picture {\n\twidth: 30px; \n\theight: 30px;\n\tmargin: 0 0 0px 0;\n}\n\n.ctitle {\n    margin: 0px 0px 0px 20px;\n}</style> \n            <div class=\"box type1\">\n                    <div class=\"sub-box\">\n                        <img src=\"myutils/icons/question.png\" alt=\"Icon\" class=\"picture\"/>\n                        <div class=\"ctitle\">\n                            <u><h4><strong>Question(s)</strong></h4></u>\n                        </div>\n                    </div>\n                    <div class=\"sub-box\">\n                        Which column has NaNs? How many are they?\n                    </div>\n            </div>\n        \n            <div class=\"box type2\">\n                <div class=\"sub-box\">\n                    <img src=\"myutils/icons/thinking.png\" alt=\"Icon\" class=\"picture\"/>\n                    <div class=\"ctitle\">\n                        <u><h4><strong>What to do?</strong></h4></u>\n                    </div>\n                </div>\n                <div class=\"sub-box\">\n                    Go through the DataFrame columns one by one and count the NaNs\n                </div>\n            </div>    \n        \n            <div class=\"box type4\">\n                <div class=\"sub-box\">\n                    <img src=\"myutils/icons/code_expl.png\" alt=\"Icon\" class=\"picture\"/>\n                    <div class=\"ctitle\">\n                        <u><h4><strong>Coding</strong></h4></u>\n                    </div>\n                </div>\n                <div class=\"sub-box\">\n                    <div>\n                        <pre  style=\"display: inline-block; float: left; margin-right: 10px\">for column_name in column_names: \n    selected_column = df[column_name] \n    selected_column_na = selected_column.isna() \n    n_nan = selected_column_na.sum() \n    print(column_name,\"has\",n_nan,\"NaN\") </pre>, we start with a for loop scrolling all the elements contained in the variable <code>column_names</code>.     In this variable we previously stored all the column names. In this way the variable <code>column_name</code>     will containg a single column name for each iteration of the loop. We then use the column name to select that     specific column in our DataFrame, storing this selected column in the variable <code>selected_column</code>.     We apply the method <code>.isna()</code> to the selected column to obtain, instead of a column of numerical or     string values, a column of True and False (boolean) values. We use the method <code>.sum()</code> to sum all     the True and False values. Keeping in mind that True is equivalent to 1 and False to 0, this will result in     counting all the NaN values in the selected column. We store this last result in the variable <code>n_nan</code>.     We finally print this result, together with the name of the selected column, using the python function <code>print()</code>.\n                    </div>       \n                </div>\n            </div>    \n        \n            <div class=\"box type5\">\n                <div class=\"sub-box\">\n                    <img src=\"myutils/icons/wiz.png\" alt=\"Icon\" class=\"picture\"/>\n                    <div class=\"ctitle\">\n                        <u><h4><strong>Expert Coding</strong></h4></u>\n                    </div>\n                </div>\n                <div class=\"sub-box\">\n                    <div>\n                        <pre  style=\"display: inline-block; float: left; margin-right: 10px\">for i,column_name in enumerate(column_names): \n        print(f\"{i}) {column_name} has {df[column_name].isna().sum()} NaN\") </pre>, we can apply the methods described above one after another, without storing any intermidiate result in a new     variable. We can also use the python function <code>enumerate()</code> to not only scroll through the <code>df</code>     column names, but also for counting the loop iterations starting from the first one (index 0). The iteration index     will be stored in the variable <code>i</code>.\n                    </div>  \n                </div>\n            </div>    \n        \n```\n:::\n:::\n\n\n::: {.cell execution_count=11}\n``` {.python .cell-code}\nfor column_name in column_names:\n    selected_column = df[column_name]\n    selected_column_na = selected_column.isna()\n    n_nan = selected_column_na.sum()\n    print(column_name,'has',n_nan,'NaN')\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nYear of arrival at port of disembarkation has 1 NaN\nVoyage ID has 0 NaN\nVessel name has 1614 NaN\nVoyage itinerary imputed port where began (ptdepimp) place has 4508 NaN\nVoyage itinerary imputed principal place of slave purchase (mjbyptimp)  has 2210 NaN\nVoyage itinerary imputed principal port of slave disembarkation (mjslptimp) place has 4191 NaN\nVOYAGEID2 has 36101 NaN\nCaptives arrived at 1st port has 17743 NaN\nCaptain's name has 4028 NaN\n```\n:::\n:::\n\n\nand if we want to keep in mind the column index of each column...\n\n::: {.cell execution_count=12}\n``` {.python .cell-code}\nfor i,column_name in enumerate(column_names): \\\n    print(f\"{i}) {column_name} has {df[column_name].isna().sum()} NaN\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n0) Year of arrival at port of disembarkation has 1 NaN\n1) Voyage ID has 0 NaN\n2) Vessel name has 1614 NaN\n3) Voyage itinerary imputed port where began (ptdepimp) place has 4508 NaN\n4) Voyage itinerary imputed principal place of slave purchase (mjbyptimp)  has 2210 NaN\n5) Voyage itinerary imputed principal port of slave disembarkation (mjslptimp) place has 4191 NaN\n6) VOYAGEID2 has 36101 NaN\n7) Captives arrived at 1st port has 17743 NaN\n8) Captain's name has 4028 NaN\n```\n:::\n:::\n\n\n::: {.cell execution_count=13}\n\n::: {.cell-output .cell-output-display execution_count=13}\n```{=html}\n<style>.box {\n\tborder: 1px solid !important;\n    border-radius: 5px !important;\n\tpadding: 10px !important;\n\tmargin: 0px 10px 0px 10px !important;\n}\n\n.sub-box {\n  display: flex !important; \n  flex-direction: row !important; \n  align-items: center !important;\n}\n\n.type1 {\n\tborder-color: black;\n\tbackground-color: rgb(246, 255, 222); \n}\n\n.type2 {\n\tborder-color: black;\n\tbackground-color: rgb(227, 242, 193); \n}\n\n.type3 {\n\tborder-color: black;\n\tbackground-color: rgb(201, 219, 178); \n}\n\n.type4 {\n\tborder-color: black;\n\tbackground-color: rgb(170, 200, 167); \n}\n\n.type5 {\n    border-color: black;\n\tbackground-color: rgb(181, 192, 208);\n}\n\n.type6 {\n    border-color: black;\n\tbackground-color: rgb(255, 195, 116);\n}\n\n.picture {\n\twidth: 30px; \n\theight: 30px;\n\tmargin: 0 0 0px 0;\n}\n\n.ctitle {\n    margin: 0px 0px 0px 20px;\n}</style>\n            <div class=\"box type6\">\n                <div class=\"sub-box\">\n                    <img src=\"myutils/icons/solution.png\" alt=\"Icon\" class=\"picture\"/>\n                    <div class=\"ctitle\">\n                        <u><h4><strong>Answer</strong></h4></u>\n                    </div>\n                </div>\n                <div class=\"sub-box\">\n                    The only column that does not have NaNs is the Voyage ID column, all the others (excluding the Year of Arrival [...]) have thousands of NaNs.\n                </div>\n            </div>    \n        \n```\n:::\n:::\n\n\nAt this point we have a general idea of the amount of data missing in our DataFrame. The following question is how to deal with this missing data? There are several things we can do, the easiest option would be just exclude it from our DataFrame. However, in order to answer a research question, we often do not need to use or explore ALL the available information and we would usually be interested in some parameters more than others. In this case our data selection could be performed looking at one or more specific columns. What to do with the rest of the NaNs? We can either leave them as they are and trying to figure out how our analysis program will \"digest\" these values or find good substitute for them. The value of this substitute will depend on the data type of the columns containing the NaN and on our decision. For example the NaN in the columns containing a descriptive string, like the vessel name or the starting port, could be substituted by the string \"unknown\". NaNs in the \"Captives arrived [...]\" column could be left as they are (you may be tempted to change them to 0, but zero captives is quite different from unknown number of captives) or substituted by, for example, the average of captives during the same year. <br>\nEach choice will have different implications to our final results, the most important thing in this stage is to clearly document our criteria for filtering NaN. In our specific case we will be mostly interested in the data containing the number of captives, so we want to filter our all those rows where the number of captives is NaN. We will then exclude the columns VOYAGEID2 as we already have a voyage ID and it is not listed in the data [variable description](https://www.slavevoyages.org/voyage/about#variable-list/2/en/). To resume, here there are our cleaning criteria:\n- All the rows not containing data about the number of captives have been removed;\n- All the NaN values in columns with descriptive information (e.g. names) have been substituted with \"unknown\";\n- The column VOYAGEID2 has been removed from the DataFrame.\n\n::: {.cell execution_count=14}\n\n::: {.cell-output .cell-output-display execution_count=14}\n```{=html}\n<style>.box {\n\tborder: 1px solid !important;\n    border-radius: 5px !important;\n\tpadding: 10px !important;\n\tmargin: 0px 10px 0px 10px !important;\n}\n\n.sub-box {\n  display: flex !important; \n  flex-direction: row !important; \n  align-items: center !important;\n}\n\n.type1 {\n\tborder-color: black;\n\tbackground-color: rgb(246, 255, 222); \n}\n\n.type2 {\n\tborder-color: black;\n\tbackground-color: rgb(227, 242, 193); \n}\n\n.type3 {\n\tborder-color: black;\n\tbackground-color: rgb(201, 219, 178); \n}\n\n.type4 {\n\tborder-color: black;\n\tbackground-color: rgb(170, 200, 167); \n}\n\n.type5 {\n    border-color: black;\n\tbackground-color: rgb(181, 192, 208);\n}\n\n.type6 {\n    border-color: black;\n\tbackground-color: rgb(255, 195, 116);\n}\n\n.picture {\n\twidth: 30px; \n\theight: 30px;\n\tmargin: 0 0 0px 0;\n}\n\n.ctitle {\n    margin: 0px 0px 0px 20px;\n}</style> \n            <div class=\"box type1\">\n                    <div class=\"sub-box\">\n                        <img src=\"myutils/icons/task.png\" alt=\"Icon\" class=\"picture\"/>\n                        <div class=\"ctitle\">\n                            <u><h4><strong>Task(s)</strong></h4></u>\n                        </div>\n                    </div>\n                    <div class=\"sub-box\">\n                        Cleaning data\n                    </div>\n            </div>\n        \n            <div class=\"box type2\">\n                <div class=\"sub-box\">\n                    <img src=\"myutils/icons/thinking.png\" alt=\"Icon\" class=\"picture\"/>\n                    <div class=\"ctitle\">\n                        <u><h4><strong>What to do?</strong></h4></u>\n                    </div>\n                </div>\n                <div class=\"sub-box\">\n                    <ul><li>Remove all the data of the column VOYAGEID2;</li><li>Go through all the values of the column \"Captives arrived at 1st port\" and remove rows containing NaNs;</li><li>Go through all the values of the descriptive columns and change NaN into \"unknown\"</li><li>Check how much data has been filtered out.</li></ul>\n                </div>\n            </div>    \n        \n            <div class=\"box type3\">\n                <div class=\"sub-box\">\n                    <img src=\"myutils/icons/tools.png\" alt=\"Icon\" class=\"picture\"/>\n                    <div class=\"ctitle\">\n                        <u><h4><strong>(Python) Tools</strong></h4></u>\n                    </div>\n                </div>\n                <div class=\"sub-box\">\n                    <ul><li>Python function <code>print()</code>;</li><li><code>pandas</code> attribute <code>.columns</code>;</li><li><code>pandas</code> method <code>drop()</code>;</li><li><code>pandas</code> method <code>.head()</code>;</li><li><code>pandas</code> method <code>.dropna()</code>;</li><li><code>pandas</code> method <code>.fillna()</code>;</li><li><code>pandas</code> attribute <code>.shape</code>;</li><li>Python function <code>len()</code>;</li><li>Python operators * (multiplication), / (division), and - (subtraction)</li></ul>\n                </div>            \n            </div>    \n        \n            <div class=\"box type4\">\n                <div class=\"sub-box\">\n                    <img src=\"myutils/icons/code_expl.png\" alt=\"Icon\" class=\"picture\"/>\n                    <div class=\"ctitle\">\n                        <u><h4><strong>Coding</strong></h4></u>\n                    </div>\n                </div>\n                <div class=\"sub-box\">\n                    <div>\n                        <ul><li><code>print(df.columns)</code>, we start printing the name of our DataFrame columns, just as a reminder. We use     the Python function <code>print()</code> and the <code>pandas</code> attribute <code>.columns</code> that     we already used several times;</li><li><pre  style=\"display: inline-block; float: left; margin-right: 10px\">column_to_remove = \"VOYAGEID2\" \ncolumn_to_remove_nan = \"Captives arrived at 1st port\" </pre>, we store the name of the columns we are interested in into two variables. This is not stricktly     necessary, as we could use the name of the columns directly as input for methods and functions. However, with this     extra step, our code will be more readable as we are using two very descriptive variable names: <code>column_to_remove</code>     will, indeed, contain the name of the column we want to remove from our DataFrame (VOYAGEID2) and <code>column_to_remove_nan</code>     will contain the name of the column to use as a reference for filtering rows, all the rows having NaN in this column     will be removed;</li><li><code>cleaned_df_step1 = df.drop(column_to_remove,axis=1)</code>, we use the method <code>.drop()</code> to remove     a specific column. Each row of a <code>pandas</code> DataFrame has an index. This index is different from the index     that every Python list of objects has, i.e. an integer number starting from 0. This DataFrame index is an additional     index that can be not only a number, but also a string or a label. The <code>pandas</code> method <code>.drop()</code>     can be used either to remove columns, depending on column names, or rows, depending on <code>pandas</code> index.     To indicate that we want to target columns, and not rows, we need to specify the parameter <code>axis</code> equal     to 1 (0 would target the rows). Together with that, we also need to specify the name of the column we want to remove, stored     in the variable <code>column_to_remove</code>. In this way, we apply the method <code>.drop()</code> to our \"dirty\"     DataFrame <code>df</code> and we store the result into the variable <code>cleaned_df_step1</code>;</li><li><code>cleaned_df_step1.head(5)</code>, after every filtering operation, it is a good idea to check out the effect on     our output result. In this case we use the <code>pandas</code> method <code>.head()</code> to visualise the first five     rows of our DataFrame <code>cleaned_df_step1</code></li><li><code>cleaned_df_step2 = cleaned_df_step1.dropna(subset=[column_to_remove_nan])</code>, we use the method <code>.dropna()</code>     to filter out all the rows having NaN in a list of columns. The list of columns needs to be specified in the function     parameter <code>subset</code>. In this case we have a single column name stored in the variable <code>column_to_remove_nana</code>     and to make it a list we put this variable in between square brackets <code>[ ]</code>. We apply the method to the     DataFrame <code>cleaned_df_step1</code> and store the result in <code>cleaned_df_step2</code>;</li><li><code>cleaned_df = cleaned_df_step2.fillna(\"unknown\")</code>, we finally use the method <code>.fillna()</code> to fill all     the NaN in our DataFrame with a certain value, in this case the string (word) \"unknown\". We apply the method to the     DataFrame <code>cleaned_df_step2</code> and store the result into <code>cleaned_df</code>;</li><li><pre  style=\"display: inline-block; float: left; margin-right: 10px\">print(cleaned_df.shape) \nn_filtered_rows = len(df)-len(cleaned_df) \nper_cent = (n_filtered_rows/len(df))*100 </pre>, this block of Python instructions checks the size of our filtered DataFrame <code>cleaned_df</code> and     compares it with our original, raw, DataFrame <code>df</code>. We first visualise the size of <code>cleaned_df</code>     using the attribute <code>.shape</code>, then we obtain simply the number of rows of each DataFrame using the Python     function <code>len()</code>. We subtract the number of rows of the DataFrames before and after filtering to check how many     rows we filtered out and we store the result into the variable <code>n_filtered_rows</code>. We finally compute the percent     of filtered rows compared to the initial size of the DataFrame.</li></ul>\n                    </div>       \n                </div>\n            </div>    \n        \n```\n:::\n:::\n\n\n::: {.cell execution_count=15}\n``` {.python .cell-code}\n# Display the name of the columns first\nprint(df.columns)\n\n# Select our target columns for clearning the data\ncolumn_to_remove = 'VOYAGEID2'\ncolumn_to_remove_nan = 'Captives arrived at 1st port'\n\n# Perform Data Cleaning visualising the result step by step\n# step1, removing column VOYAGEID2 from the DataFrame\ncleaned_df_step1 = df.drop(column_to_remove,axis=1)\ncleaned_df_step1.head(5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nIndex(['Year of arrival at port of disembarkation', 'Voyage ID', 'Vessel name',\n       'Voyage itinerary imputed port where began (ptdepimp) place',\n       'Voyage itinerary imputed principal place of slave purchase (mjbyptimp) ',\n       'Voyage itinerary imputed principal port of slave disembarkation (mjslptimp) place',\n       'VOYAGEID2', 'Captives arrived at 1st port', 'Captain's name'],\n      dtype='object')\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=15}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Year of arrival at port of disembarkation</th>\n      <th>Voyage ID</th>\n      <th>Vessel name</th>\n      <th>Voyage itinerary imputed port where began (ptdepimp) place</th>\n      <th>Voyage itinerary imputed principal place of slave purchase (mjbyptimp)</th>\n      <th>Voyage itinerary imputed principal port of slave disembarkation (mjslptimp) place</th>\n      <th>Captives arrived at 1st port</th>\n      <th>Captain's name</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1714.0</td>\n      <td>16109</td>\n      <td>Freeke Gally</td>\n      <td>Bristol</td>\n      <td>NaN</td>\n      <td>Kingston</td>\n      <td>283.0</td>\n      <td>Neale, Alexander</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>1713.0</td>\n      <td>16110</td>\n      <td>Greyhound Gally</td>\n      <td>Bristol</td>\n      <td>NaN</td>\n      <td>Jamaica, place unspecified</td>\n      <td>NaN</td>\n      <td>Selkirk, Alexander&lt;br/&gt; Forrest, Henry</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>1714.0</td>\n      <td>16111</td>\n      <td>Jacob</td>\n      <td>Bristol</td>\n      <td>NaN</td>\n      <td>Kingston</td>\n      <td>130.0</td>\n      <td>Nicholls, Philip</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>1714.0</td>\n      <td>16112</td>\n      <td>Jason Gally</td>\n      <td>Bristol</td>\n      <td>NaN</td>\n      <td>Port Royal</td>\n      <td>278.0</td>\n      <td>Plummer, John</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>1713.0</td>\n      <td>16113</td>\n      <td>Lawford Gally</td>\n      <td>Bristol</td>\n      <td>Africa, port unspecified</td>\n      <td>Newcastle (Nevis)</td>\n      <td>NaN</td>\n      <td>Stretton, Joseph</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {.cell execution_count=16}\n``` {.python .cell-code}\n# step2, removing all the rows haveing NaN in the \"Captives arrived at 1st port\" column\ncleaned_df_step2 = cleaned_df_step1.dropna(subset=[column_to_remove_nan])\ncleaned_df_step2.head(5)\n```\n\n::: {.cell-output .cell-output-display execution_count=16}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Year of arrival at port of disembarkation</th>\n      <th>Voyage ID</th>\n      <th>Vessel name</th>\n      <th>Voyage itinerary imputed port where began (ptdepimp) place</th>\n      <th>Voyage itinerary imputed principal place of slave purchase (mjbyptimp)</th>\n      <th>Voyage itinerary imputed principal port of slave disembarkation (mjslptimp) place</th>\n      <th>Captives arrived at 1st port</th>\n      <th>Captain's name</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1714.0</td>\n      <td>16109</td>\n      <td>Freeke Gally</td>\n      <td>Bristol</td>\n      <td>NaN</td>\n      <td>Kingston</td>\n      <td>283.0</td>\n      <td>Neale, Alexander</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>1714.0</td>\n      <td>16111</td>\n      <td>Jacob</td>\n      <td>Bristol</td>\n      <td>NaN</td>\n      <td>Kingston</td>\n      <td>130.0</td>\n      <td>Nicholls, Philip</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>1714.0</td>\n      <td>16112</td>\n      <td>Jason Gally</td>\n      <td>Bristol</td>\n      <td>NaN</td>\n      <td>Port Royal</td>\n      <td>278.0</td>\n      <td>Plummer, John</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>1714.0</td>\n      <td>16114</td>\n      <td>Mercy Gally</td>\n      <td>Bristol</td>\n      <td>Africa, port unspecified</td>\n      <td>Barbados, place unspecified</td>\n      <td>190.0</td>\n      <td>Scott, John</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>1714.0</td>\n      <td>16115</td>\n      <td>Mermaid Gally</td>\n      <td>Bristol</td>\n      <td>Cape Verde Islands</td>\n      <td>Kingston</td>\n      <td>72.0</td>\n      <td>Banbury, John&lt;br/&gt; Copinger, James</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {.cell execution_count=17}\n``` {.python .cell-code}\n# step3, changing all the other NaN into unknown\ncleaned_df = cleaned_df_step2.fillna(\"unknown\")\ncleaned_df.head(5)\n```\n\n::: {.cell-output .cell-output-display execution_count=17}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Year of arrival at port of disembarkation</th>\n      <th>Voyage ID</th>\n      <th>Vessel name</th>\n      <th>Voyage itinerary imputed port where began (ptdepimp) place</th>\n      <th>Voyage itinerary imputed principal place of slave purchase (mjbyptimp)</th>\n      <th>Voyage itinerary imputed principal port of slave disembarkation (mjslptimp) place</th>\n      <th>Captives arrived at 1st port</th>\n      <th>Captain's name</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1714.0</td>\n      <td>16109</td>\n      <td>Freeke Gally</td>\n      <td>Bristol</td>\n      <td>unknown</td>\n      <td>Kingston</td>\n      <td>283.0</td>\n      <td>Neale, Alexander</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>1714.0</td>\n      <td>16111</td>\n      <td>Jacob</td>\n      <td>Bristol</td>\n      <td>unknown</td>\n      <td>Kingston</td>\n      <td>130.0</td>\n      <td>Nicholls, Philip</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>1714.0</td>\n      <td>16112</td>\n      <td>Jason Gally</td>\n      <td>Bristol</td>\n      <td>unknown</td>\n      <td>Port Royal</td>\n      <td>278.0</td>\n      <td>Plummer, John</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>1714.0</td>\n      <td>16114</td>\n      <td>Mercy Gally</td>\n      <td>Bristol</td>\n      <td>Africa, port unspecified</td>\n      <td>Barbados, place unspecified</td>\n      <td>190.0</td>\n      <td>Scott, John</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>1714.0</td>\n      <td>16115</td>\n      <td>Mermaid Gally</td>\n      <td>Bristol</td>\n      <td>Cape Verde Islands</td>\n      <td>Kingston</td>\n      <td>72.0</td>\n      <td>Banbury, John&lt;br/&gt; Copinger, James</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {.cell execution_count=18}\n``` {.python .cell-code}\n# step4, checking how much data we filtered out\nprint(cleaned_df.shape)\nn_filtered_rows = len(df)-len(cleaned_df)\nper_cent = (n_filtered_rows/len(df))*100\nprint('We filtered out: ',len(df)-len(cleaned_df),', corresponding to about', round(per_cent), '% of our initial data')\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n(18408, 8)\nWe filtered out:  17743 , corresponding to about 49 % of our initial data\n```\n:::\n:::\n\n\nIt seems that because of our filtering, almost half of our data will be excluded from the analysis. This is a quite large percent and we may decide to re-think our filtering criteria to include more data. For example, we could substitue the missing value in the Captives column with an avarage number of captived per trip. For the purpose of our workshop, we will keep the current filtering criteria and keep our filtered DataFrame as it is.\n\nAt this point we obtained a \"clean\" DataFrame, ```cleaned_df```, containing 18408 rows with values organised in 8 columns. We can now start diving deep in the analysis of our DataFrame, we are ready to interrogate this dataset and see which kind of story it is going to tell us.\n\n",
    "supporting": [
      "ch3_data_cleaning_files/figure-html"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}